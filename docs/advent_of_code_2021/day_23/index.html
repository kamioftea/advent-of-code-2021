<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This is my solution for Advent of Code - Day 23 - Amphipod"><meta name="keywords" content="rust, rustlang, rust-lang, day_23"><title>advent_of_code_2021::day_23 - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../advent_of_code_2021/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><h2 class="location">Module day_23</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></div><div id="sidebar-vars" data-name="day_23" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../index.html">advent_of_code_2021</a>::<wbr><a class="mod" href="#">day_23</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/advent_of_code_2021/day_23.rs.html#1-543" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This is my solution for <a href="https://adventofcode.com/2021/day/23">Advent of Code - Day 23 - <em>Amphipod</em></a></p>
<p>This one I really struggled with. Almost entirely due to me misreading the puzzle description, and missing the
restrictions on Amphipod movement that vastly restrict the graph of moves. It took eventually despairing, looking
up others’ solutions, seeing a bunch of things that seemed weird, and going back to work out why. By this point
I’d rewritten my state representation as an integer of upto 23 3-bit sections from which I could unpack the state,
so that I could more efficiently store the states in a Binary Heap. I was able to shoe-horn in the restrictions to
my existing code, but that journey has left it pretty unreadable. I have left it as is, and will try to make it
clearer what is going on with some comments. It is worth noting that my initial, less restricted solution still
worked for part one, though it did take about 6 minutes to complete.</p>
<p><a href="struct.Burrow.html" title="Burrow"><code>Burrow</code></a> is the previously mentioned state-as-integer, which contains the state, and the length for ease of
determining how many leading 0’s are significant. <a href="struct.Burrow.html#method.from" title="Burrow::from"><code>Burrow::from</code></a> is used for creating burrows from a string in
tests. <a href="struct.Burrow.html#method.fmt" title="Burrow::fmt"><code>Burrow::fmt</code></a> turns the integer into a string of letters so debugging is possible. <a href="struct.Burrow.html#method.get_at" title="Burrow::get_at"><code>Burrow::get_at</code></a> does
some bit-manipulation to get the Amphipod type, if any, at that position. <a href="struct.Burrow.html#method.set_at" title="Burrow::set_at"><code>Burrow::set_at</code></a> uses more bit tricks to
mutate the state of one of the positions and <a href="struct.Burrow.html#method.swap" title="Burrow::swap">Burrow::swap</a> uses these to swap the state between two positions, used
to move Amphipods. <a href="struct.State.html" title="State"><code>State</code></a> wraps a <a href="struct.Burrow.html" title="Burrow"><code>Burrow</code></a> with a cost to enable using Dijkstra’s algorithm to solve the puzzle
with a graph search. <a href="../day_15/index.html" title="crate::day_15"><code>crate::day_15</code></a> has a cleaner implementation of this. Note <a href="struct.Burrow.html#method.cmp" title="Burrow::cmp"><code>Burrow::cmp</code></a> is manually
implemented to reverse the ordering, so that Rust’s default <a href="https://doc.rust-lang.org/1.57.0/alloc/collections/binary_heap/struct.BinaryHeap.html" title="BinaryHeap"><code>BinaryHeap</code></a>, which is a max-heap, works as the
required min-heap instead</p>
<p><a href="fn.parse_letter.html" title="parse_letter"><code>parse_letter</code></a> turns an <code>.</code>, <code>A</code>, <code>B</code>, <code>C</code>, or <code>D</code> into a number 0-4 to represent the possible state for each
cell. <a href="fn.parse_input.html" title="parse_input"><code>parse_input</code></a> parses the ascii diagram of the burrow, mostly by ignoring every thing that isn’t <code>A</code>, <code>B</code>,
<code>C</code>, or <code>D</code>. <a href="fn.build_goal.html" title="build_goal"><code>build_goal</code></a> builds the burrow representing the expected final state of the burrow for a given depth
of side-tunnels. <a href="fn.build_states.html" title="build_states"><code>build_states</code></a> returns a list of possible states, and the cost to move there from the given
state. This is where the worst of the mess is, as it relies on a lot of number manipulation tricks to turn the flat
15/23 cell list of cells into something that represents the more complex burrow structure. <a href="fn.find_shortest_path.html" title="find_shortest_path"><code>find_shortest_path</code></a> is
just implementing Dijkstra’s Algorithm and is very similar to <a href="../day_15/index.html" title="crate::day_15"><code>crate::day_15</code></a>’s version, but with a different
adjacency/cost implementation. Finally <a href="fn.expand_burrow.html" title="expand_burrow"><code>expand_burrow</code></a> handles turning the input for part one into the input for
part two.</p>
</div></details><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Burrow.html" title="advent_of_code_2021::day_23::Burrow struct">Burrow</a></div><div class="item-right docblock-short"><p>Represents a burrow as an integer that can be used as a list of 3-bit sections. 0-6 are the 7 cells in the hallway
where a Amphipod can stop, the cells adjacent to each side tunnel are not represented here, and instead handled by
<a href="fn.build_states.html" title="build_states"><code>build_states</code></a> accounting for them when calculating costs. The remaining cells represent the side-tunnels, reading
like a book. You can walk down a tunnel by staring at indices 7, 8, 9 or 10, and increasing by 4 each step. It is
possible to represent a burrow of up to depth 8 in the u128 used.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.State.html" title="advent_of_code_2021::day_23::State struct">State</a></div><div class="item-right docblock-short"><p>Wrapper for a Burrow state with the cost to reach that state. Implements <a href="https://doc.rust-lang.org/1.57.0/core/cmp/trait.Ord.html" title="Ord"><code>Ord</code></a> in reverse order so that we can use
Rust’s built in max-<a href="https://doc.rust-lang.org/1.57.0/alloc/collections/binary_heap/struct.BinaryHeap.html" title="BinaryHeap"><code>BinaryHeap</code></a> as a min-heap.</p>
</div></div></div><h2 id="constants" class="section-header"><a href="#constants">Constants</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.COSTS.html" title="advent_of_code_2021::day_23::COSTS constant">COSTS</a></div><div class="item-right docblock-short"><p>The cost to move each type of Amphipod in order A-D</p>
</div></div></div><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.build_goal.html" title="advent_of_code_2021::day_23::build_goal fn">build_goal</a></div><div class="item-right docblock-short"><p>Return a burrow that represents the target state for a given depth.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.build_states.html" title="advent_of_code_2021::day_23::build_states fn">build_states</a></div><div class="item-right docblock-short"><p>This handles building the possible next states respecting the limits on Amphipod movement returning a list of the
possible states and the cost for each.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.expand_burrow.html" title="advent_of_code_2021::day_23::expand_burrow fn">expand_burrow</a></div><div class="item-right docblock-short"><p>Add in the two extra lines that were hidden behind the fold for part two.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.find_shortest_path.html" title="advent_of_code_2021::day_23::find_shortest_path fn">find_shortest_path</a></div><div class="item-right docblock-short"><p>Use Dijkstra’s algorithm to represent the puzzle as a graph of states, and find the shortest path (i.e. lowest
total move energy) for the Amphipods to all reach their desired tunnel.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.parse_input.html" title="advent_of_code_2021::day_23::parse_input fn">parse_input</a></div><div class="item-right docblock-short"><p>Parse the ascii-art diagram into the internal representation.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.parse_letter.html" title="advent_of_code_2021::day_23::parse_letter fn">parse_letter</a></div><div class="item-right docblock-short"><p>Turn a letter in the ascii-art into the number we use to represent it internally</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.run.html" title="advent_of_code_2021::day_23::run fn">run</a></div><div class="item-right docblock-short"><p>The entry point for running the solutions with the ‘real’ puzzle input.</p>
</div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../" data-current-crate="advent_of_code_2021" data-search-index-js="../../search-index.js" data-search-js="../../search.js"></div>
    <script src="../../main.js"></script>
</body></html>