<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This is my solution for Advent of Code - Day 24 - Arithmetic Logic Unit"><meta name="keywords" content="rust, rustlang, rust-lang, day_24"><title>advent_of_code_2021::day_24 - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><script defer src="../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a class="sidebar-logo" href="../../advent_of_code_2021/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.png" alt="logo"></div>
        </a><h2 class="location">Module day_24</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></div><div id="sidebar-vars" data-name="day_24" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../advent_of_code_2021/index.html"><img class="rust-logo" src="../../rust-logo.png" alt="logo"></a><nav class="sub"><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../index.html">advent_of_code_2021</a>::<wbr><a class="mod" href="#">day_24</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/advent_of_code_2021/day_24.rs.html#1-252" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This is my solution for <a href="https://adventofcode.com/2021/day/24">Advent of Code - Day 24 - <em>Arithmetic Logic Unit</em></a></p>
<p>Today was a challenge of interpreting an assembly language adjacent program and working out the underlying logic
about which inputs it accepts or rejects. Looking through the puzzle data it seemed like a lot of statements were
no-ops so I first wondered if the puzzle was just to factor out the redundant commands and brute0force it, but after
a bit of trying to write a parser that would reduce the program to just the key bits in calculating the final <code>z</code>
value. This was a bit of a dead end, but did clue me into the repeating nature of the input. The no-op
operations we’re repeated later on, but in the later context they did do something. Also I had written <a href="fn.parse_input.html" title="parse_input">parse_input</a>
and <a href="enum.Instruction.html#method.from" title="Instruction::from"><code>Instruction::from</code></a>, and <a href="enum.Param.html" title="Param"><code>Param</code></a> and <a href="enum.OpType.html" title="OpType"><code>OpType</code></a> to have a structured representation of the commands.</p>
<p>At this point I was working things out in a <a href="https://docs.google.com/spreadsheets/d/1EvNOOa-1rTDfxe4yj2pe-3x6HPskKhz1nLXUFkL9M64/edit">rather disorganised spreadsheet</a>
Sheet 1 is me stepping through the logic. Copy of sheet 1 shows the program split into its repeating sections.</p>
<p><img src="../../assets/img/day-24.png" alt="Working out spreadsheet" title="A screenshot of my working out spread sheet showing the
program split into 18 row sections laid out next to each other. Underneath there is working showing variables
being added/removed from the stack represented by `z`" /></p>
<p>The MONAD program is a loop that repeats the same 18 lines, with a few variable values. Here is a walk through of
my first 18 line section:</p>
<div class="example-wrap"><pre class="language-text"><code> 1. inp w      |  Read the next input into `w`  
 2. mul x 0    |  Reset `x` to 0
 3. add x z    |  Copy z into x
 4. mod x 26   |  z is treated like a stack of base 26 numbers, this mod sets
               |  `x` to the top of the stack
 5. div z 1    |  The number here is always 1 or 26. `z / 1` is a no-op,
               |  `z / 26` pops the `prev` number from the top of the `z`
               |  stack.
 6. add x 13   |  The number here is variable per section, I&#39;ll call it `n`.
               |  This is adding `n` to `prev`.
 7. eql x w    |  `1` if `prev` + `n` == `inout` (`w` is the latest digit
               |  input.)
 8. eql x 0    |  This is inverting line 7 so `prev` + `n` != `input`
 9. mul y 0    |  Reset `y` to 0
10. add y 25   |  Set `y` to 25
11. mul y x    |  `x` is 1 if the modified previous stack value != `input`, 0
               |  otherwise. So `y` is now either `0` or `25` based on the
               |  same condition.
12. add y 1    |  `y` is now either 1 or 26 based on the same condition.
13. mul z y    |  If `y` is 1, then this is a no-op otherwise this is shifting
               |  0 onto the top of the `z` stack
14. mul y 0    |  Reset `y` to 0 again
15. add y w    |  Copy the input into `y`
16. add y 15   |  The literal here varies, I&#39;ll call it `p`.
17. mul y x    |  Same idea as line 11, if `prev` + `n` != `input` this is a
               |  no-op, if `prev` + `n` == `input` y is now 0.
18. add z y    |  If `y` is still non-zero, update the 0 we pushed onto the  
               |  stack to be `input` + `p`.</code></pre></div>
<p>So written as rust code this could be seen as:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">fn</span> <span class="ident">section</span>(<span class="ident">input</span>: <span class="ident">isize</span>, <span class="ident">z</span>: <span class="kw-2">&amp;mut</span> <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">isize</span><span class="op">&gt;</span>, <span class="ident">pop</span>: <span class="ident">bool</span>, <span class="ident">n</span>: <span class="ident">isize</span>, <span class="ident">p</span>: <span class="ident">isize</span>) {
    <span class="kw">let</span> <span class="ident">x</span> <span class="op">=</span> <span class="ident">z</span>.<span class="ident">last</span>().<span class="ident">unwrap</span>() <span class="op">+</span> <span class="ident">n</span>;

    <span class="kw">if</span> <span class="ident">pop</span> {<span class="ident">z</span>.<span class="ident">pop</span>()};

    <span class="kw">if</span> <span class="ident">input</span> <span class="op">!</span><span class="op">=</span> <span class="ident">x</span> {
        <span class="ident">z</span>.<span class="ident">push</span>(<span class="ident">input</span> <span class="op">+</span> <span class="ident">p</span>);
    };
}</code></pre></div>
<p>It is also worth noting that as <code>input</code> is in the range <code>1</code> - <code>9</code>. So for some of the inputs it is guaranteed
that they’ll be pushed onto the stack regardless of input. I stepped through the whole 14 sections by hand and
worked out that for z to be 0 (i.e. the stack is empty) each time <code>prev + n</code> could equal the input, it had to
match as the guaranteed pop operations matched the count of the guaranteed pushes, so each time it was possible
not to push we had to take it, or numbers would be left on the stack. This gave me the criteria for the valid
numbers. I made some human errors stepping through the constraints so the number I worked out failed, but since
this is a coding problem I should eliminate that by coding the analysis instead. <a href="fn.analyse_program.html" title="analyse_program"><code>analyse_program</code></a> does just
that. Working out the maximum valid model number (part one), and then part two (the minimum) was a minor
modification.</p>
<p>Overall, whilst there is some satisfaction in having worked out what was going on, I was not a fan of today’s
puzzle. The answer was in deduction, so examples that actually helped a solver would have given the game away.
This meant the usual plan of build some tests from the example as a guide doesn’t apply and makes the whole
experience more frustrating when it doesn’t work (as it didn’t for me when stepping through by hand). The only
feedback is that your answer is wrong, but you also can’t go looking for hints as to why, as that gives the whole
game away.</p>
</div></details><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Instruction.html" title="advent_of_code_2021::day_24::Instruction enum">Instruction</a></div><div class="item-right docblock-short"><p>Encode each line as either a read from input, or an operation</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.OpType.html" title="advent_of_code_2021::day_24::OpType enum">OpType</a></div><div class="item-right docblock-short"><p>Whilst there are six instructions the <code>Inp</code> is different enough from the others that it is easier to split it out.
This then encodes the type of the remaining five op codes.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Param.html" title="advent_of_code_2021::day_24::Param enum">Param</a></div><div class="item-right docblock-short"><p>Represents a operation’s parameter(s) as either one of the four memory addresses or a literal number</p>
</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.analyse_program.html" title="advent_of_code_2021::day_24::analyse_program fn">analyse_program</a></div><div class="item-right docblock-short"><p>First split the program into its 18-line sections. For each extract the three variables. Tracking what <code>input + p</code> values are on the stack, and where it is possible to avoid pushing to the stack, storing that as a condition.
Then iterate through these conditions working out where parts of the input are constrained by them and updating the
minimum and maximum numbers as appropriate. Finally return this minimum (part two) and maximum (part one).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.parse_input.html" title="advent_of_code_2021::day_24::parse_input fn">parse_input</a></div><div class="item-right docblock-short"><p>Parse each line of the puzzle input program return with <a href="enum.Instruction.html#method.from" title="Instruction::from"><code>Instruction::from</code></a>, return the program as a list fo
instructions.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.run.html" title="advent_of_code_2021::day_24::run fn">run</a></div><div class="item-right docblock-short"><p>The entry point for running the solutions with the ‘real’ puzzle input.</p>
</div></div></div></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="advent_of_code_2021" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.59.0 (9d1b2106e 2022-02-23)" ></div>
</body></html>